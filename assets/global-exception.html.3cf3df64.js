import{r as p,c as l,a as n,b as a,F as t,e as c,d as e,o as r}from"./app.b80325f2.js";import{_ as o}from"./plugin-vue_export-helper.21dcd24c.js";const i={},u=c(`<h2 id="\u80CC\u666F" tabindex="-1"><a class="header-anchor" href="#\u80CC\u666F" aria-hidden="true">#</a> \u80CC\u666F</h2><p>\u6211\u4EEC\u77E5\u9053\u63A5\u53E3\u7684\u8FD4\u56DE\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\u5C31\u53EA\u6709\u4E09\u79CD\u72B6\u6001\uFF0C\u6210\u529F\u3001\u5931\u8D25\u548C\u8D85\u65F6\u54CD\u5E94\uFF0C\u800C\u63A5\u53E3\u7684\u65B9\u6CD5\u8C03\u7528\u7ED3\u679C\u53EF\u80FD\u4F1A\u51FA\u73B0\u5F88\u591A\u5F02\u5E38\u4FE1\u606F\u3002\u5728\u5B9E\u9645\u7684\u4E1A\u52A1\u5F00\u53D1\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u8981\u6C42\u63A5\u53E3\u7684\u5F02\u5E38\u4FE1\u606F\u662F\u4E00\u5B9A\u8981\u5904\u7406\u6389\u7684\uFF0C\u4E0D\u80FD\u76F4\u63A5\u628A\u4E00\u4E2A\u5806\u6808\u4FE1\u606F\u8FD4\u56DE\u7ED9\u524D\u7AEF\u7528\u6237\u7684\u3002\u8FD9\u6837\u8981\u6C42\u7684\u539F\u56E0\u662F\uFF1A</p><ol><li>\u4E00\u5927\u5806\u7684\u5F02\u5E38\u4FE1\u606F\u4F1A\u5F71\u54CD\u7528\u6237\u4F53\u9A8C\u3002\u7528\u6237\u662F\u4E0D\u61C2\u6280\u672F\u7684\uFF0C\u63A5\u53E3\u8FD4\u56DE\u4E00\u5927\u5806\u5F02\u5E38\u4FE1\u606F\uFF0C\u7528\u6237\u672C\u80FD\u7684\u5C31\u8BA4\u4E3A\u7CFB\u7EDF\u51FA\u4E86\u95EE\u9898\uFF0C\u8FD9\u5F71\u54CD\u7528\u6237\u4F53\u9A8C\uFF1B\u4F46\u662F\u8FD4\u56DE\u80FD\u591F\u88AB\u7528\u6237\u6240\u7406\u89E3\u7684\u4FE1\u606F\uFF0C\u5219\u662F\u53EF\u4EE5\u63A5\u53D7\u7684\u3002</li><li>\u66B4\u9732\u5F02\u5E38\u4FE1\u606F\u5F71\u54CD\u7CFB\u7EDF\u53EF\u7528\u6027\u8BC4\u4EF7\u3002\u63A5\u53E3\u8FD4\u56DE\u4E00\u5927\u5806\u5F02\u5E38\u4FE1\u606F\uFF0C\u9664\u4E86\u7528\u6237\u672C\u80FD\u7684\u8BA4\u4E3A\u7CFB\u7EDF\u51FA\u4E86\u95EE\u9898\uFF0C\u4E1A\u52A1\u90E8\u95E8\u4E5F\u4F1A\u89C9\u5F97\u7CFB\u7EDF\u6B64\u65F6\u4E0D\u53EF\u7528\u3002</li><li>\u5F02\u5E38\u4FE1\u606F\u5343\u5947\u767E\u602A\uFF0C\u4E0D\u5229\u4E8E\u524D\u7AEF\u5904\u7406\u3002</li></ol><p>\u4E8B\u5B9E\u4E0A\uFF0C\u4E00\u4E2A\u67B6\u6784\u4F18\u826F\u7684\u7CFB\u7EDF\uFF0C\u662F\u9700\u8981\u524D\u7AEF\u5F00\u53D1\u548C\u540E\u7AEF\u5F00\u53D1\u76F8\u4E92\u914D\u5408\u7684\u3002\u524D\u7AEF\u548C\u540E\u7AEF\u5F00\u53D1\u7EA6\u5B9A\u597D\u63A5\u53E3\u7684\u54CD\u5E94\u683C\u5F0F\uFF0C\u7136\u540E\u518D\u6839\u636E\u8FD9\u4E2A\u683C\u5F0F\u5B8C\u6210\u524D\u540E\u7AEF\u7684\u516C\u5171\u6A21\u5757\u7684\u5F00\u53D1\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\u540E\u7AEF\u5BF9\u5E94\u7684\u4E1A\u52A1\u529F\u80FD\u5C31\u662F<code>\u5168\u5C40\u7EDF\u4E00\u54CD\u5E94</code>\u3002</p><h2 id="\u5168\u5C40\u7EDF\u4E00\u54CD\u5E94" tabindex="-1"><a class="header-anchor" href="#\u5168\u5C40\u7EDF\u4E00\u54CD\u5E94" aria-hidden="true">#</a> \u5168\u5C40\u7EDF\u4E00\u54CD\u5E94</h2><p>\u5B9E\u9645\u4E0A\uFF0C\u6211\u4EEC\u53EF\u4EE5\u628A\u5F02\u5E38\u4E5F\u5F52\u7C7B\u4E3A\u4E00\u79CD\u7279\u6B8A\u7684\u8FD4\u56DE\u7ED3\u679C\u3002\u5168\u5C40\u7EDF\u4E00\u54CD\u5E94\u6709\u4EC0\u4E48\u4E1A\u52A1\u8981\u6C42\u6216\u4E1A\u52A1\u7279\u70B9\u5462\uFF1F</p><p>\u5BF9\u5F02\u5E38\u7684\u8981\u6C42\uFF1A</p><ol><li>\u652F\u6301\u4EE3\u7801\u4E2D\u629B\u51FA\u5F02\u5E38\u4FE1\u606F\uFF0C\u5E76\u4E14\u629B\u51FA\u7684\u5F02\u5E38\u4FE1\u606F\u7684\u683C\u5F0F\u8981\u6C42\u7EDF\u4E00\uFF1B</li><li>\u5F02\u5E38\u4FE1\u606F\u7684\u683C\u5F0F\u5E94\u4E0E\u63A5\u53E3\u6B63\u5E38\u54CD\u5E94\u6216\u5931\u8D25\u54CD\u5E94\u7684\u6D88\u606F\u4F53\u683C\u5F0F\u4FDD\u6301\u4E00\u81F4\uFF1B</li><li>\u5F02\u5E38\u4FE1\u606F\u8981\u652F\u6301\u56FD\u9645\u5316\uFF1B</li><li>\u5F02\u5E38\u4FE1\u606F\u7F16\u7801\u8981\u5177\u6709\u4E1A\u52A1\u542B\u4E49\uFF1B</li></ol><p>\u5BF9\u54CD\u5E94\u7684\u8981\u6C42\uFF1A</p><ol><li>\u652F\u6301\u9ED8\u8BA4\u7684\u54CD\u5E94\u6210\u529F\u6216\u54CD\u5E94\u5931\u8D25\u7684\u7ED3\u679C\uFF1B</li><li>\u54CD\u5E94\u4FE1\u606F\u652F\u6301\u56FD\u9645\u5316\uFF1B</li><li>\u4E0E\u5F02\u5E38\u4FE1\u606F\u7684\u683C\u5F0F\u4FDD\u6301\u4E00\u81F4\uFF1B</li></ol><p>\u9664\u4E86\u8FD9\u4E9B\u4EE5\u5916\uFF0C\u8FD8\u4F1A\u6709\u5176\u4ED6\u7EC6\u5316\u7684\u9700\u6C42\u3002\u4EE5\u4E0B\u662F\u51E0\u4E2A\u5E38\u7528\u7684\u573A\u666F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// \u9047\u5230\u4E1A\u52A1\u51FA\u73B0\u5F02\u5E38\u65F6\uFF0C\u76F4\u63A5\u629B\u51FA\u5F02\u5E38\u4FE1\u606F

// \u6709\u4E9B\u524D\u7AEF\u4F20\u8FC7\u6765\u7684\u8BF7\u6C42\u53C2\u6570\u9700\u8981\u505A\u6821\u9A8C\uFF0C\u9047\u5230\u6821\u9A8C\u4E0D\u901A\u8FC7\u7684\u76F4\u63A5\u629B\u51FA\u5F02\u5E38\u4FE1\u606F

// \u63A5\u53E3\u6B63\u5E38\u54CD\u5E94\u65F6\uFF0C\u8FD4\u56DE\u6B63\u5E38\u54CD\u5E94\u6D88\u606F\u4F53

// \u63A5\u53E3\u54CD\u5E94\u5931\u8D25\u65F6\uFF0C\u8FD4\u56DE\u9ED8\u8BA4\u7684\u54CD\u5E94\u5931\u8D25\u6D88\u606F\u4F53
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u6839\u636E\u4E0A\u9762\u7684\u4E1A\u52A1\u7279\u70B9\uFF0C\u6211\u4EEC\u660E\u786E\u5B9E\u73B0\u76EE\u6807\uFF1A</p><ol><li>Nacos\u4F5C\u4E3A\u914D\u7F6E\u4E2D\u5FC3\uFF0C\u4F46\u662F\u9700\u8981\u6211\u4EEC\u81EA\u884C\u7F16\u5199\u5DE5\u5177\u7C7B\uFF0C\u6700\u7EC8\u8FBE\u5230\u7684\u76EE\u7684\u662F\uFF0C\u540C\u4E00\u4E2A\u5F02\u5E38\u7F16\u7801\u5BF9\u5E94\u591A\u56FD\u8BED\u8A00\u7684\u5F02\u5E38\u4FE1\u606F\uFF0C\u5E76\u4E14\u80FD\u591F\u81EA\u52A8\u5237\u65B0\uFF08\u5373\u4FEE\u6539Nacos\u7ACB\u5373\u751F\u6548\uFF09\uFF1B</li><li>\u914D\u5408Validation\u4F7F\u7528\u65F6\uFF0C\u5BF9\u4E1A\u52A1\u4E3B\u6D41\u7A0B\u4FB5\u5165\u6027\u8FBE\u5230\u6700\u5C0F\uFF0C\u6700\u597D\u662F\u96F6\u4FB5\u5165\uFF1B</li><li>\u7EDF\u4E00\u54CD\u5E94\u4F53\u6D88\u606F\u683C\u5F0F\uFF0C\u5E76\u4E14\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528success\u548Cerror\u65B9\u6CD5\uFF1B</li><li>\u4E1A\u52A1\u4EE3\u7801\u4E2D\u629B\u51FA\u5F02\u5E38\u7684\u65B9\u5F0F\u4E0Ejdk\u629B\u51FA\u5F02\u5E38\u65B9\u5F0F\u5728\u4F7F\u7528\u65B9\u5F0F\u4E0A\u4E00\u81F4\uFF0C\u4F46\u662F\u4E1A\u52A1\u4E2D\u629B\u51FA\u7684\u5F02\u5E38\u4FE1\u606F\u7684\u54CD\u5E94\u7ED3\u679C\u4E0E\u81EA\u5B9A\u4E49\u7684\u54CD\u5E94\u6D88\u606F\u4F53\u683C\u5F0F\u4FDD\u6301\u4E00\u81F4\uFF1B</li></ol><h2 id="\u5B9E\u6218\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u6218\u8FC7\u7A0B" aria-hidden="true">#</a> \u5B9E\u6218\u8FC7\u7A0B</h2><p>\u4E3B\u8981\u5305\u62EC\u4E09\u4E2A\u65B9\u9762\uFF1A</p><ol><li>\u91CD\u5199\u8BED\u8A00\u89E3\u6790\u5668\u3002\u8FD9\u4E2A\u6B65\u9AA4\u662F\u53EF\u9009\u7684\uFF0C\u4E3B\u8981\u76EE\u7684\u662F\u6539\u53D8\u8BF7\u6C42\u5934\u91CC\u9762\u8BED\u8A00\u7684\u5C5E\u6027\u540D\u3002</li><li>\u6784\u5EFA\u914D\u7F6E\u4FE1\u606F\u3002\u8FD9\u4E2A\u6B65\u9AA4\u662F\u628A\u56FD\u9645\u5316\u7684\u914D\u7F6E\u4FE1\u606F\u914D\u7F6E\u5230\u914D\u7F6E\u4E2D\u5FC3\uFF0C\u7136\u540E\u76D1\u542C\u6570\u636E\u53D8\u66F4\uFF0C\u5E76\u6784\u5EFA\u4E00\u4E2A\u5DE5\u5177\u7C7B\u8BA9\u7EDF\u4E00\u54CD\u5E94\u529F\u80FD\u548C\u7EDF\u4E00\u5F02\u5E38\u5904\u7406\u529F\u80FD\u4F7F\u7528\u3002</li><li>\u6784\u5EFA\u7EDF\u4E00\u54CD\u5E94\u6D88\u606F\u4F53\u3002\u8FD9\u4E2A\u6B65\u9AA4\u662F\u683C\u5F0F\u5316\u63A5\u53E3\u7684\u54CD\u5E94\u4FE1\u606F\uFF0C\u9700\u8981\u5229\u7528\u5230\u4E0A\u4E00\u6B65\u7F16\u5199\u7684\u5DE5\u5177\u7C7B\u3002</li><li>\u6784\u5EFA\u7EDF\u4E00\u5F02\u5E38\u5904\u7406\u3002\u8FD9\u4E2A\u6B65\u9AA4\u662F\u683C\u5F0F\u5316\u5F02\u5E38\u4FE1\u606F\u7684\u54CD\u5E94\u4FE1\u606F\uFF0C\u9700\u8981\u5229\u7528\u5230\u7B2C\u4E8C\u6B65\u7F16\u5199\u7684\u5DE5\u5177\u7C7B\u3002</li></ol><h3 id="\u91CD\u5199\u8BED\u8A00\u89E3\u6790\u5668" tabindex="-1"><a class="header-anchor" href="#\u91CD\u5199\u8BED\u8A00\u89E3\u6790\u5668" aria-hidden="true">#</a> \u91CD\u5199\u8BED\u8A00\u89E3\u6790\u5668</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public class LanguageResolver implements LocaleResolver {
    /**
     * \u8BF7\u6C42header\u5B57\u6BB5
     */
    private static final String LANG = &quot;lang&quot;;

    /**
     * session
     */
    private static final String LANG_SESSION = &quot;lang_session&quot;;
    @Override
    public Locale resolveLocale(HttpServletRequest request) {
        String lang = request.getHeader(LANG);
        Locale locale = Locale.getDefault();
        if (StringUtils.isNotBlank(lang)){
            String[] language = lang.split(&quot;_&quot;);
            locale = new Locale(language[0], language[1]);

            HttpSession session = request.getSession();
            session.setAttribute(LANG_SESSION, locale);
        }else{
            HttpSession session = request.getSession();
            Locale localeInSession = (Locale) session.getAttribute(LANG_SESSION);
            if (localeInSession != null){
                locale = localeInSession;
            }
        }
        return locale;
    }

    @Override
    public void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale) {

    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Configuration
public class MessageConfig {

    @Bean
    public LocaleResolver localeResolver(){
        return new LanguageResolver();
    }

}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="\u6784\u5EFA\u914D\u7F6E\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#\u6784\u5EFA\u914D\u7F6E\u4FE1\u606F" aria-hidden="true">#</a> \u6784\u5EFA\u914D\u7F6E\u4FE1\u606F</h3><p>\u8FD9\u91CC\u6211\u4EEC\u9009\u7528Alibaba-Nacos\u7EC4\u4EF6\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>server:
  port: 10300
spring:
  application:
    name: global-exception
  cloud:
    nacos:
      config:
        # nacos\u7684\u670D\u52A1\u7AEF\u5730\u5740
        server-addr: 192.168.1.150:8848
        # \u5E94\u7528\u63A5\u5165\u7684\u547D\u540D\u7A7A\u95F4\u7684id
        namespace: 8d269024-f215-4195-be82-f6343cafde9c
        # \u547D\u540D\u5206\u7EC4
        group: DEV
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u914D\u7F6E\u4E00\u4E2A\u679A\u4E3E\u7C7B\uFF0C\u679A\u4E3E\u51FA\u6240\u6709\u7684\u56FD\u9645\u5316\u7684\u5F02\u5E38\u7801\u8868\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public enum NacosJson2ObjEnum {

    MESSAGE_ZH_CN(&quot;message_zh_cn&quot;, &quot;\u4E1A\u52A1\u5F02\u5E38\u7801\u8868\uFF08\u7B80\u4E2D\uFF09&quot;, Map.class),
    MESSAGE_EN_US(&quot;message_en_us&quot;, &quot;\u4E1A\u52A1\u5F02\u5E38\u7801\u8868\uFF08\u82F1\u6587\uFF09&quot;, Map.class)
    ;

    private String dataId;
    private String desc;
    private Class clz;

    NacosJson2ObjEnum(String dataId, String desc, Class clz) {
        this.dataId = dataId;
        this.desc=desc;
        this.clz =clz;
    }

    public String getDataId(){
        return dataId;
    }

    public String getDesc(){
        return desc;
    }

    public Class getClz(){
        return clz;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>\u5229\u7528Spring\u521D\u59CB\u5316Bean\u673A\u5236\uFF0C\u628A\u56FD\u9645\u5316\u5F02\u5E38\u7801\u8868\u4FE1\u606F\u52A0\u8F7D\u672C\u5730\u5185\u5B58\u4E2D\uFF0C\u5E76\u8BBE\u7F6E\u76D1\u542C\u5668\u76D1\u542CNacos\u4E0A\u9762\u7684\u914D\u7F6E\u53D8\u5316\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Slf4j
@Component
public class NacosConfig implements InitializingBean {
    @Autowired
    private NacosConfigProperties nacosConfigProperties;

    @Value(&quot;\${spring.cloud.nacos.config.group}&quot;)
    private String group;

    private ConfigService configService;
    private Map&lt;String, Object&gt; localCatchMap = new HashMap&lt;&gt;();

    private static ThreadPoolExecutor executor =
            new ThreadPoolExecutor(
                    2,
                    4,
                    1,
                    TimeUnit.SECONDS,
                    new LinkedBlockingDeque&lt;&gt;(100),
                    new ThreadPoolExecutor.CallerRunsPolicy()
            );

    @Override
    public void afterPropertiesSet() throws Exception {
        // \u83B7\u53D6 Nacos \u670D\u52A1\u7AEF \u5177\u4F53\u914D\u7F6E
        String serverAddr = nacosConfigProperties.getServerAddr();
        String namespace = nacosConfigProperties.getNamespace();

        // \u5C01\u88C5 Nacos server \u914D\u7F6E\u53C2\u6570
        Properties properties = new Properties();
        properties.put(PropertyKeyConst.SERVER_ADDR, serverAddr);
        properties.put(PropertyKeyConst.NAMESPACE, namespace);
        if (configService == null) {
            configService = NacosFactory.createConfigService(properties);
        }

        NacosJson2ObjEnum[] nacosJson2ObjEnums = NacosJson2ObjEnum.values();
        for (NacosJson2ObjEnum nacosJson2ObjEnum : nacosJson2ObjEnums) {
            String dataId = nacosJson2ObjEnum.getDataId();
            String config = configService.getConfig(dataId, group, 1000);

            // \u628A\u83B7\u53D6\u5230\u7684\u914D\u7F6E\u4FE1\u606F\u653E\u5230\u672C\u5730map\u4E2D
            jsonToObject(config, nacosJson2ObjEnum);

            // \u8BBE\u7F6E\u76D1\u542C\u5668\uFF0C\u76D1\u542C\u914D\u7F6E\u53D8\u5316
            configService.addListener(
                    nacosJson2ObjEnum.getDataId(),
                    group,
                    new NacosJsonConfigDataListener(nacosJson2ObjEnum)
            );
        }

    }

    public void jsonToObject(String json, NacosJson2ObjEnum eNacosJsonDefinition) {
        Object data = JSON.parseObject(json, eNacosJsonDefinition.getClz());
        log.info(&quot;Get Nacos Config Data, dataId = {} --- data = {}&quot;,
                eNacosJsonDefinition.getDataId(), data);
        localCatchMap.put(eNacosJsonDefinition.getDataId(), data);
    }

    public class NacosJsonConfigDataListener implements Listener {
        private NacosJson2ObjEnum nacosJson2ObjEnum;

        private NacosJsonConfigDataListener(NacosJson2ObjEnum nacosJson2ObjEnum) {
            this.nacosJson2ObjEnum = nacosJson2ObjEnum;
        }

        @Override
        public Executor getExecutor() {
            return executor;
        }

        @Override
        public void receiveConfigInfo(String configInfo) {
            jsonToObject(configInfo, nacosJson2ObjEnum);
        }
    }

    public &lt;T&gt; T getNacosJson2Object(NacosJson2ObjEnum nacosJson2ObjEnum, Class&lt;? extends T&gt; clz) {
        Object data = localCatchMap.get(nacosJson2ObjEnum.getDataId());
        if (clz.isInstance(data)) {
            return (T)data;
        }
        throw new IllegalArgumentException(&quot;\u8F6C\u6362\u7C7B\u578B\u5931\u8D25&quot;);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><p>\u5BF9\u5916\u63D0\u4F9B\u4E00\u4E2A\u5DE5\u5177\u7C7B\uFF0C\u83B7\u53D6\u56FD\u9645\u5316\u7684\u5F02\u5E38\u4FE1\u606F\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Component
public class MessageNacosUtil {

    @Autowired
    private static NacosConfig nacosConfig;

    @Autowired
    public void setNacosConfig(NacosConfig nacosConfig) {
        MessageNacosUtil.nacosConfig = nacosConfig;
    }

    public static String getExcptMsg(String excptCode) {
        return StrFormatter.format(getMessageMap().get(excptCode), null);
    }

    public static String getExcptMsg(String excptCode, String... args) {
        return StrFormatter.format(getMessageMap().get(excptCode), args);
    }

    public static Map&lt;String, String&gt; getMessageMap(){
        Map&lt;String, String&gt; messageMap = null;
        String language = LocaleContextHolder.getLocale().getLanguage();
        if (&quot;&quot;.equals(language) || &quot;zh&quot;.equals(language)) {
            messageMap = nacosConfig.getNacosJson2Object(NacosJson2ObjEnum.MESSAGE_ZH_CN, Map.class);
        } else {
            messageMap = nacosConfig.getNacosJson2Object(NacosJson2ObjEnum.MESSAGE_EN_US, Map.class);
        }
        return messageMap;
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="\u6784\u5EFA\u7EDF\u4E00\u54CD\u5E94\u6D88\u606F\u4F53" tabindex="-1"><a class="header-anchor" href="#\u6784\u5EFA\u7EDF\u4E00\u54CD\u5E94\u6D88\u606F\u4F53" aria-hidden="true">#</a> \u6784\u5EFA\u7EDF\u4E00\u54CD\u5E94\u6D88\u606F\u4F53</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u5982\u679C\u54CD\u5E94\u7ED3\u679C\u4E2D\u53EA\u7ED9\u4E86code\uFF0C\u90A3\u4E48msg\u5C31\u53BBnacos\u4E2D\u67E5\u8BE2
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">DataResponse</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DataResponse</span> dataResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataResponse<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataResponse<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">MessageNacosUtil</span><span class="token punctuation">.</span><span class="token function">getExcptMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataResponse<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataResponse<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">DataResponse</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DataResponse</span> dataResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataResponse<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataResponse<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataResponse<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataResponse<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u54CD\u5E94\u6210\u529F\u7684\u6D88\u606F\u8FDB\u884C\u56FA\u5B9A\u5E76\u7EDF\u4E00
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">DataResponse</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token class-name">ResponseStatusCode</span><span class="token punctuation">.</span>OK<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u54CD\u5E94\u5931\u8D25\u652F\u6301\u81EA\u5B9A\u4E49code\u548Cmsg
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataResponse</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u9ED8\u8BA4\u7684\u54CD\u5E94\u5931\u8D25\u7ED3\u679C
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataResponse</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token class-name">ResponseStatusCode</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="\u6784\u5EFA\u7EDF\u4E00\u5F02\u5E38\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#\u6784\u5EFA\u7EDF\u4E00\u5F02\u5E38\u5904\u7406" aria-hidden="true">#</a> \u6784\u5EFA\u7EDF\u4E00\u5F02\u5E38\u5904\u7406</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">BaseException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">BaseException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">BaseException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">BaseException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BizException</span> <span class="token keyword">extends</span> <span class="token class-name">BaseException</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">BaseResponse</span> baseResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BizException</span><span class="token punctuation">(</span><span class="token class-name">BaseResponse</span> baseResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>baseResponse<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;, &quot;</span><span class="token operator">+</span> baseResponse<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baseResponse <span class="token operator">=</span> baseResponse<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">BizException</span><span class="token punctuation">(</span><span class="token class-name">BaseResponse</span> baseResponse<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>baseResponse<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> baseResponse<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baseResponse <span class="token operator">=</span> baseResponse<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u629B\u51FA\u5F02\u5E38\u652F\u6301\u591A\u4E2Amsg\u8FDB\u884C\u7EC4\u5408\u62FC\u88C5
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">BizException</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>code<span class="token operator">+</span> <span class="token string">&quot;, &quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baseResponse<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> excptMsg <span class="token operator">=</span> <span class="token class-name">MessageNacosUtil</span><span class="token punctuation">.</span><span class="token function">getExcptMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baseResponse<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>excptMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token class-name">BizException</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>code<span class="token operator">+</span> <span class="token string">&quot;, &quot;</span><span class="token operator">+</span>msg<span class="token punctuation">,</span> throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baseResponse<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baseResponse<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>\u5173\u952E\u4E00\u6B65\uFF0C\u91CD\u5199\u81EA\u5B9A\u4E49\u7684\u5F02\u5E38\u4FE1\u606F\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(value = BizException.class)   // \u9879\u76EE\u4E2D\u9047\u5230 BizException \u65F6\u7684\u5904\u7406\u903B\u8F91
    public ResponseEntity bizExceptionHandler(BizException bizException) {
        BaseResponse baseResponse = bizException.getBaseResponse();
        return new ResponseEntity(baseResponse, HttpStatus.OK);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528" aria-hidden="true">#</a> \u4F7F\u7528</h2><p>\u5F00\u53D1\u8FC7\u7A0B\u4E2D\u8FD8\u6D89\u53CA\u5230\u8BF7\u6C42\u53C2\u6570\u7684\u6821\u9A8C\u8FC7\u7A0B\uFF0C\u8FD9\u91CC\u6211\u4EEC\u9009\u7528Validation\u7684\u5DE5\u5177\u7C7B\u3002\u4E0B\u9762\u662F\u96C6\u6210\u8FC7\u7A0B\u3002</p><h3 id="\u96C6\u6210validation" tabindex="-1"><a class="header-anchor" href="#\u96C6\u6210validation" aria-hidden="true">#</a> \u96C6\u6210Validation</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(value = BizException.class)
    public ResponseEntity bizExceptionHandler(BizException bizException) {
        BaseResponse baseResponse = bizException.getBaseResponse();
        return new ResponseEntity(baseResponse, HttpStatus.OK);
    }

    // \u9047\u5230 \u53C2\u6570\u6821\u9A8C\u65F6\u7684\u5F02\u5E38\u5904\u7406
    @ExceptionHandler(value = MethodArgumentNotValidException.class)
    public ResponseEntity methodArgumentNotValidExceptionHandler(MethodArgumentNotValidException methodArgumentNotValidException) {
        BindingResult bindingResult = methodArgumentNotValidException.getBindingResult();
        if (bindingResult.getFieldErrors() != null) {
            // \u5982\u679C\u6821\u9A8C\u7ED3\u679C\u4E2D\u6709\u591A\u4E2A\u5F02\u5E38\uFF0C\u5C31\u53EA\u8FD4\u56DE\u7B2C\u4E00\u4E2A\u5F02\u5E38\u4FE1\u606F
            String excptCode = bindingResult.getFieldErrors().get(0).getDefaultMessage();
            String excptMsg = MessageNacosUtil.getExcptMsg(excptCode);
            BizException bizException = new BizException(excptCode, excptMsg);
            return new ResponseEntity(bizException.getBaseResponse(), HttpStatus.OK);
        }
        return new ResponseEntity(null, HttpStatus.OK);
    }
}

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u6D4B\u8BD5" aria-hidden="true">#</a> \u6D4B\u8BD5</h3><p>\u6211\u4EEC\u5728nacos\u4E0A\u6DFB\u52A0\u914D\u7F6E\u6587\u4EF6\uFF0C\u5E76\u586B\u5145\u5185\u5BB9\u3002</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203347.png" alt="20230423203347" loading="lazy"></p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203405.png" alt="20230423203405" loading="lazy"></p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203424.png" alt="20230423203424" loading="lazy"></p><p>\u6211\u4EEC\u7F16\u5199\u4E00\u4E2Acontroller\u8FDB\u884C\u6D4B\u8BD5\uFF1A</p><ol><li>\u76F4\u63A5\u629B\u51FA\u4E1A\u52A1\u5F02\u5E38</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@GetMapping(&quot;/throw2_01&quot;)
public OperationResponse test02_01() {

    if (&quot;0&quot;.equals(&quot;0&quot;)) {
        throw new BizException(ResponseStatusCode.EE1001);
    }
    return OperationResponse.success(MessageNacosUtil.getExcptMsg(ResponseStatusCode.OK));
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203254.png" alt="20230423203254" loading="lazy"></p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203454.png" alt="20230423203454" loading="lazy"></p><ol start="2"><li>\u629B\u51FA\u6821\u9A8C\u5F02\u5E38</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
@Data
public class UserDTO {

    // \u6821\u9A8C\u6CE8\u89E3\u7684message\u76F4\u63A5\u4E3A\u4E00\u4E2A\u5E38\u91CF\u5B57\u7B26\u4E32
    @NotEmpty(message = ResponseStatusCode.EE2001)
    private String name;

    @NotBlank(message = ResponseStatusCode.EE2002)
    private String address;


    private String sex;
    private Integer age;
    private Long phonenum;
}

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@PostMapping(&quot;/throw2_02&quot;)
public DataResponse&lt;UserDTO&gt; test02_02(
        @RequestBody @Validated UserDTO userDTO
) {
    return DataResponse.success(userDTO);
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203629.png" alt="20230423203629" loading="lazy"></p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203516.png" alt="20230423203516" loading="lazy"></p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203543.png" alt="20230423203543" loading="lazy"></p><p>\u539F\u7406\u89E3\u8BFB\uFF1A @NotBlank \u548C @NotEmpty \u6CE8\u89E3\u6821\u9A8C\u4E0D\u901A\u8FC7\u65F6\uFF0C\u4F1A\u629B\u51FA MethodArgumentNotValidException \u5F02\u5E38\u4FE1\u606F\uFF0C\u800C\u6211\u4EEC\u5728 GlobalExceptionHandler \u4E2D\u6355\u83B7\u8FD9\u4E2A\u5F02\u5E38\u4FE1\u606F\u4E4B\u540E\u505A\u4E86\u81EA\u5B9A\u4E49\u5904\u7406\u903B\u8F91\uFF0C\u5927\u6982\u903B\u8F91\u5C31\u662F\u5148\u83B7\u53D6\u5230\u629B\u51FA\u5F02\u5E38\u4FE1\u606F\u7684message\u4FE1\u606F\uFF0C\u62FF\u5230\u5F02\u5E38\u7801\uFF0C\u4E4B\u540E\u5229\u7528\u5DE5\u5177\u7C7B\u548C\u8BED\u8A00\u4FE1\u606F\u4ECENacos\u4E2D\u83B7\u53D6\u5F02\u5E38\u7801\u7684\u63CF\u8FF0\u4FE1\u606F\u3002</p><p>\u6CE8\u610F\uFF1A \u4E0A\u9762\u7684\u6355\u83B7MethodArgumentNotValidException\u540E\u7684\u5904\u7406\u903B\u8F91\u4E2D\u53EA\u5904\u7406\u4E86\u6240\u629B\u51FA\u7684\u7B2C\u4E00\u4E2A\u5F02\u5E38\u4FE1\u606F\uFF0C\u81EA\u6D4B\u591A\u6B21\u540C\u4E00\u4E2A\u8BF7\u6C42\u7C7B\uFF0C\u7531\u4E8E\u662F\u591A\u4E2A\u5B57\u6BB5\u6821\u9A8C\uFF0C\u53EF\u80FD\u4F1A\u629B\u51FA\u4E0D\u540C\u7684\u5F02\u5E38\u4FE1\u606F\uFF0C\u8FD9\u91CC\u9700\u8981\u505A\u81EA\u5B9A\u4E49\u5B9E\u73B0\u3002</p><ol start="3"><li>\u629B\u51FA\u7EC4\u5408\u540E\u7684\u5F02\u5E38\u4FE1\u606F</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@PostMapping(&quot;/throw2_03&quot;)
public DataResponse&lt;UserDTO&gt; test02_03(
        @RequestBody @Validated UserDTO userDTO
) {
    if (&quot;female&quot;.equals(userDTO.getSex())) {
        throw new BizException(ResponseStatusCode.EE3001, userDTO.getName());
    }
    return DataResponse.success(userDTO);
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203707.png" alt="20230423203707" loading="lazy"></p><ol start="4"><li>\u629B\u51FA\u591A\u4E2A\u53C2\u6570\u7EC4\u6210\u7684\u5F02\u5E38\u4FE1\u606F</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@PostMapping(&quot;/throw2_04&quot;)
public DataResponse&lt;UserDTO&gt; test02_04(
        @RequestBody @Validated UserDTO userDTO
) {
    if (&quot;female&quot;.equals(userDTO.getSex()) &amp;&amp; userDTO.getPhonenum()&lt;138000) {
        throw new BizException(ResponseStatusCode.EE3002, userDTO.getName(), String.valueOf(userDTO.getPhonenum()));
    }
    return DataResponse.success(userDTO);
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203733.png" alt="20230423203733" loading="lazy"></p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203756.png" alt="20230423203756" loading="lazy"></p><ol start="5"><li>\u8FD4\u56DE\u9ED8\u8BA4\u7684\u54CD\u5E94\u5931\u8D25\u6D88\u606F\u4F53</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@PostMapping(&quot;/throw2_05&quot;)
public DataResponse&lt;UserDTO&gt; test02_05(
        @RequestBody @Validated UserDTO userDTO
) {
    return DataResponse.error();

}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230423203814.png" alt="20230423203814" loading="lazy"></p><h2 id="\u53C2\u8003" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a> \u53C2\u8003</h2>`,72),b={href:"https://blog.csdn.net/qq_15898739/article/details/104680114",target:"_blank",rel:"noopener noreferrer"},m=e("Nacos\u5B9E\u73B0SpringBoot\u56FD\u9645\u5316\u7684\u589E\u5F3A"),d={href:"https://mp.weixin.qq.com/s/XE4R2wOj08qNivo8Ms5ZRQ",target:"_blank",rel:"noopener noreferrer"},g=e("Java\u7EDF\u4E00\u5F02\u5E38\u5904\u7406(\u914D\u7F6E\u6587\u4EF6\u96C6\u4E2D\u5316\u5B9A\u4E49)"),k={href:"https://developer.aliyun.com/article/1180037",target:"_blank",rel:"noopener noreferrer"},h=e("\u4E09\u79CD\u624B\u6BB5\uFF1A\u901A\u8FC7Apollo\u548Cnacos\u7684\u80FD\u529B\u8FDB\u884C\u56FD\u9645\u5316\u52A8\u6001\u914D\u7F6E\u5B9E\u73B0\u70ED\u66F4\u65B0"),x=n("hr",null,null,-1),v=n("img",{style:{border:"1px red solid",display:"block",margin:"0 auto"},src:"https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/img/qrcode.jpg",alt:"\u5FAE\u4FE1\u516C\u4F17\u53F7"},null,-1);function E(f,S){const s=p("ExternalLinkIcon");return r(),l(t,null,[u,n("ul",null,[n("li",null,[n("a",b,[m,a(s)])]),n("li",null,[n("a",d,[g,a(s)])]),n("li",null,[n("a",k,[h,a(s)])])]),x,v],64)}var w=o(i,[["render",E],["__file","global-exception.html.vue"]]);export{w as default};
