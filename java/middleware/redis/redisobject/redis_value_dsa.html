<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zeanzai.me/java/middleware/redis/redisobject/redis_value_dsa.html"><meta property="og:site_name" content="天晴小猪"><meta property="og:title" content="底层数据结构"><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-08-17T04:43:51.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Redis"><meta property="article:modified_time" content="2023-08-17T04:43:51.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><title>底层数据结构 | 天晴小猪</title><meta name="description" content="天晴小猪 | 关于后端与架构设计 | Software Engineer | Backend | JAVA | DevOps | Linux | IDEA | Microservice | 我活在世上，无非想要明白些道理，遇见些有趣的事。倘能如我所愿，我的一生就算成功。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.fac109b7.css">
    <link rel="modulepreload" href="/assets/app.1d09e1ea.js"><link rel="modulepreload" href="/assets/redis_value_dsa.html.45b76fc9.js"><link rel="modulepreload" href="/assets/redis_value_dsa.html.e94ffc06.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.JPG" alt="天晴小猪"><!----><span class="site-name hide-in-pad">天晴小猪</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/java/" class="nav-link active" aria-label="Java面试宝典"><i class="icon iconfont icon-java"></i>Java面试宝典<!----></a></div><div class="nav-item hide-in-mobile"><a href="/springcloud-alibaba/" class="nav-link" aria-label="SpringCloud-Alibaba实战"><i class="icon iconfont icon-code"></i>SpringCloud-Alibaba实战<!----></a></div><div class="nav-item hide-in-mobile"><a href="/question/" class="nav-link" aria-label="面试自查宝典"><i class="icon iconfont icon-quote"></i>面试自查宝典<!----></a></div><div class="nav-item hide-in-mobile"><a href="/linux/" class="nav-link" aria-label="开发环境手册"><i class="icon iconfont icon-customize"></i>开发环境手册<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="副业之路"><span class="title"><i class="icon iconfont icon-java"></i>副业之路</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/slashteen/web/" class="nav-link" aria-label="网站建设"><i class="icon iconfont icon-page"></i>网站建设<!----></a></li></ul></button></div></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/zeanzai/zeanzai.github.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" aria-labelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" aria-labelledby="auto" style="display:block;"><title id="auto" lang="en">auto icon</title><g fill="currentColor"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" aria-labelledby="dark" style="display:none;"><title id="dark" lang="en">dark icon</title><g fill="currentColor"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" aria-labelledby="light" style="display:none;"><title id="light" lang="en">light icon</title><g fill="currentColor"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></g></svg></button></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">零、面试前准备</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">一、计算机基础</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">二、JavaCore</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">三、框架</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">四、中间件</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">MySQL</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">Redis</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/java/middleware/redis/redis-glance.html" class="nav-link sidebar-link sidebar-page" aria-label="单机版部署及可视化操作台"><!---->单机版部署及可视化操作台<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">Redis中的对象系统</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="底层数据结构"><!---->底层数据结构<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#对象系统" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="对象系统"><!---->对象系统<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#sds" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SDS"><!---->SDS<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#传统c语言中的字符串特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="传统C语言中的字符串特点"><!---->传统C语言中的字符串特点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#sds源码的迭代" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SDS源码的迭代"><!---->SDS源码的迭代<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#数据类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="数据类型"><!---->数据类型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#使用了sds之后" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用了SDS之后"><!---->使用了SDS之后<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#intset" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="intset"><!---->intset<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#升级过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="升级过程"><!---->升级过程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#linkedlist" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="linkedlist"><!---->linkedlist<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#redis的实现-双向无环链表" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis的实现 - 双向无环链表"><!---->Redis的实现 - 双向无环链表<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#ziplist" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ziplist"><!---->ziplist<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#连锁更新" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="连锁更新"><!---->连锁更新<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#总结-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#quicklist" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="quicklist"><!---->quicklist<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#hashtable" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="hashtable"><!---->hashtable<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#解决哈希冲突" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="解决哈希冲突"><!---->解决哈希冲突<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#rehash" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Rehash"><!---->Rehash<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#skiplist" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="skiplist"><!---->skiplist<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#总结-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#参考" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="参考"><!---->参考<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/java/middleware/redis/redisobject/redis_values.html" class="nav-link sidebar-link sidebar-page" aria-label="支持的数据类型"><!---->支持的数据类型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><a href="/java/middleware/redis/redis-high-character.html" class="nav-link sidebar-link sidebar-page" aria-label="高级特性"><!---->高级特性<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/middleware/redis/memory-management.html" class="nav-link sidebar-link sidebar-page" aria-label="内存淘汰机制与持久化机制"><!---->内存淘汰机制与持久化机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/middleware/redis/pro-env.html" class="nav-link sidebar-link sidebar-page" aria-label="生产环境运维"><!---->生产环境运维<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/middleware/redis/pro-problem.html" class="nav-link sidebar-link sidebar-page" aria-label="生产问题及解决方案"><!---->生产问题及解决方案<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><a href="/java/middleware/zk.html" class="nav-link sidebar-link sidebar-page" aria-label=" ZooKeeper"><!----> ZooKeeper<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/middleware/mq.html" class="nav-link sidebar-link sidebar-page" aria-label=" MQ"><!----> MQ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">五、分布式</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">六、源码系列</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">七、项目实战</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">八、学习笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">九、工作技巧</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->底层数据结构</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" aria-labelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://zeanzai.me" target="_blank" rel="noopener noreferrer">天晴小猪</a></span><span property="author" content="天晴小猪"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" aria-labelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2023年8月17日</span><meta property="datePublished" content="2023-08-17T04:43:51.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" aria-labelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category category3 clickable" role="navigation">Redis</li><meta property="articleSection" content="Redis"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" aria-labelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag tag3 clickable" role="navigation">Redis</li></ul><meta property="keywords" content="Redis"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" aria-labelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>大约 21 分钟</span><meta property="timeRequired" content="PT21M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#对象系统" class="router-link-active router-link-exact-active toc-link level2">对象系统</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#sds" class="router-link-active router-link-exact-active toc-link level2">SDS</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#传统c语言中的字符串特点" class="router-link-active router-link-exact-active toc-link level3">传统C语言中的字符串特点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#sds源码的迭代" class="router-link-active router-link-exact-active toc-link level3">SDS源码的迭代</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#数据类型" class="router-link-active router-link-exact-active toc-link level3">数据类型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#使用了sds之后" class="router-link-active router-link-exact-active toc-link level3">使用了SDS之后</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#intset" class="router-link-active router-link-exact-active toc-link level2">intset</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#升级过程" class="router-link-active router-link-exact-active toc-link level3">升级过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#总结" class="router-link-active router-link-exact-active toc-link level3">总结</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#linkedlist" class="router-link-active router-link-exact-active toc-link level2">linkedlist</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#redis的实现-双向无环链表" class="router-link-active router-link-exact-active toc-link level3">Redis的实现 - 双向无环链表</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#ziplist" class="router-link-active router-link-exact-active toc-link level2">ziplist</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#连锁更新" class="router-link-active router-link-exact-active toc-link level3">连锁更新</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#总结-1" class="router-link-active router-link-exact-active toc-link level3">总结</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#quicklist" class="router-link-active router-link-exact-active toc-link level2">quicklist</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#hashtable" class="router-link-active router-link-exact-active toc-link level2">hashtable</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#解决哈希冲突" class="router-link-active router-link-exact-active toc-link level3">解决哈希冲突</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#rehash" class="router-link-active router-link-exact-active toc-link level3">Rehash</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#skiplist" class="router-link-active router-link-exact-active toc-link level2">skiplist</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#总结-2" class="router-link-active router-link-exact-active toc-link level2">总结</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/middleware/redis/redisobject/redis_value_dsa.html#参考" class="router-link-active router-link-exact-active toc-link level2">参考</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h2 id="对象系统" tabindex="-1"><a class="header-anchor" href="#对象系统" aria-hidden="true">#</a> 对象系统</h2><p>Redis使用对象来表示每一个键值对，在Redis中创建的每一个键值对，Redis都会为我们创建至少两个RedisObject对象，一个是键对象，即key，一个是值对象，即value。键对象的数据结构为字符串，而值对象因其保存的数据内容不一样，因而其使用的数据结构也不一样。</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706092329.png" alt="20230706092329" loading="lazy"></p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// Redis 对象</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// 类型，标识该对象是什么类型的对象（String 对象、 List 对象、Hash 对象、Set 对象和 Zset 对象）；</span>
  <span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 对齐位，为了保证内存紧凑</span>
  <span class="token keyword">unsigned</span> notused<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 编码方式，标识该对象使用了哪种底层的数据结构；</span>
  <span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
  
  <span class="token comment">// LRU 时间（相对于 server.lruclock）</span>
  <span class="token keyword">unsigned</span> lru<span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 引用计数</span>
  <span class="token keyword">int</span> refcount<span class="token punctuation">;</span>
  
  <span class="token comment">// 指向底层数据结构的指针；</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>

<span class="token punctuation">}</span> robj<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>type记录了对象<code>所保存的值的类型</code>，其枚举值列表如下：</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
* 对象类型
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_STRING</span> <span class="token expression"><span class="token number">0</span>    </span><span class="token comment">// 字符串</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_LIST</span> <span class="token expression"><span class="token number">1</span>      </span><span class="token comment">// 列表</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_SET</span> <span class="token expression"><span class="token number">2</span>       </span><span class="token comment">// 集合</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ZSET</span> <span class="token expression"><span class="token number">3</span>      </span><span class="token comment">// 有序集</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_HASH</span> <span class="token expression"><span class="token number">4</span>      </span><span class="token comment">// 哈希表</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>encoding记录了对象<code>所保存的值的编码</code>，其枚举值列表如下：</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
* 对象编码
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_RAW</span> <span class="token expression"><span class="token number">0</span>          </span><span class="token comment">// 编码为字符串</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_INT</span> <span class="token expression"><span class="token number">1</span>          </span><span class="token comment">// 编码为整数</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_HT</span> <span class="token expression"><span class="token number">2</span>           </span><span class="token comment">// 编码为哈希表</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_ZIPMAP</span> <span class="token expression"><span class="token number">3</span>       </span><span class="token comment">// 编码为 zipmap</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_LINKEDLIST</span> <span class="token expression"><span class="token number">4</span>   </span><span class="token comment">// 编码为双端链表</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_ZIPLIST</span> <span class="token expression"><span class="token number">5</span>      </span><span class="token comment">// 编码为压缩列表</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_INTSET</span> <span class="token expression"><span class="token number">6</span>       </span><span class="token comment">// 编码为整数集合</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REDIS_ENCODING_SKIPLIST</span> <span class="token expression"><span class="token number">7</span>     </span><span class="token comment">// 编码为跳跃表</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="sds" tabindex="-1"><a class="header-anchor" href="#sds" aria-hidden="true">#</a> SDS</h2><h3 id="传统c语言中的字符串特点" tabindex="-1"><a class="header-anchor" href="#传统c语言中的字符串特点" aria-hidden="true">#</a> 传统C语言中的字符串特点</h3><ul><li>以“\0”结束，就意味着不能保存除了文本数据的其他数据内容，也就是无法保存视频、音频、图片等数据内容，即二进制不安全（视频、音频、图片等数据内容中可能会有“\0”）；</li><li>操作方法有内存溢出的风险；</li><li>操作字符串的方法效率不高，如获取字符串长度的时间复杂度为O（n）；</li></ul><h3 id="sds源码的迭代" tabindex="-1"><a class="header-anchor" href="#sds源码的迭代" aria-hidden="true">#</a> SDS源码的迭代</h3><ul><li>3.2之前</li></ul><div class="language-C ext-C line-numbers-mode"><pre class="language-C"><code>struct sdshdr{
    //int 记录buf数组中未使用字节的数量 
    int free;
    
    //int 记录buf数组中已使用字节的数量，即sds的长度 
    int len;
    
    //字节数组用于保存字符串
    char buf[];
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>看出 Redis 3.2 之前 SDS 内部是一个带有长度信息的字节数组。</p><ul><li>3.2及之后</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>typedef char *sds;

struct __attribute__ ((__packed__)) sdshdr5 { // 对应的字符串长度小于 1&lt;&lt;5
    unsigned char flags;
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr8 { // 对应的字符串长度小于 1&lt;&lt;8
    uint8_t len; /* 已使用长度，1 字节存储 */
    uint8_t alloc; /* 总长度 */
    unsigned char flags; 
    char buf[]; // 真正存储字符串的数据空间
};
struct __attribute__ ((__packed__)) sdshdr16 { // 对应的字符串长度小于 1&lt;&lt;16
    uint16_t len; /* 已使用长度，2 字节存储 */
    uint16_t alloc; 
    unsigned char flags; 
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr32 { // 对应的字符串长度小于 1&lt;&lt;32
    uint32_t len; /* 已使用长度，4 字节存储 */
    uint32_t alloc; 
    unsigned char flags; 
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr64 { // 对应的字符串长度小于 1&lt;&lt;64
    uint64_t len; /* 已使用长度，8 字节存储 */
    uint64_t alloc; 
    unsigned char flags; 
    char buf[];
};

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>这样就可以针对不同长度的字符串申请相应的存储类型，从而有效的节约了内存使用。</p><h3 id="数据类型" tabindex="-1"><a class="header-anchor" href="#数据类型" aria-hidden="true">#</a> 数据类型</h3><p>Redis根据为了更好的利用内存，就根据保存的数据的不同，然后使用不同的数据类型保存。</p><ul><li>int： 存储的是整数且长度小于20字节</li><li>embstr： 存储的是字符串且长度小于等于44字节</li><li>raw： 存储的是动态字符串，且长度大于44字节且小于512Mb <ul><li>redis 2.+ 是 32 字节</li><li>redis 3.0-4.0 是 39 字节</li><li>redis 5.0 是 44 字节</li></ul></li></ul><div class="custom-container tip"><p class="custom-container-title">为什么是44字节？</p><ol><li>64字节 = redisObject + SDS （内存分配器管理的大小就是64字节）</li><li>redisObject = 16字节</li><li>SDS = 4字节（包括一个字节的结束符 \0 ） + 44字节的buf[]</li></ol><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706181113.png" alt="20230706181113" loading="lazy"></p></div><h3 id="使用了sds之后" tabindex="-1"><a class="header-anchor" href="#使用了sds之后" aria-hidden="true">#</a> 使用了SDS之后</h3><ul><li><code>空间预分配</code>减少了内存频繁分配次数 <ul><li>如果修改后len长度将小于1M，这时分配给free的大小和len一样,例如修改过后为10字节, 那么给free也是10字节，buf实际长度变成了10+10+1 = 21byte；</li><li>如果修改后len长度将大于等于1M,这时分配给free的长度为1M,例如修改过后为30M,那么给free是1M.buf实际长度变成了30M+1M+1byte；</li></ul></li><li><code>惰性空间释放</code><ul><li>并不会立即回收空闲空间，而是使用free指针来记录空闲空间，以备后续使用；</li></ul></li><li><code>二进制安全</code>，保存的数据的类型更为丰富；</li><li>操作方法<code>不会产生内存溢出</code>；</li><li>依然使用“\0”的方式结尾，目的是为了复用C的一些方法，此外，<code>操作方法的时间复杂度更低</code></li></ul><h2 id="intset" tabindex="-1"><a class="header-anchor" href="#intset" aria-hidden="true">#</a> intset</h2><p>Redis作为一个内存数据库，首先要能够保存整数吧，又为了达到一种不浪费内存的目的，设计出一种整数集合的数据结构。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//每个intset结构表示一个整数集合
typedef struct intset{
    //编码方式
    uint32_t encoding;

    //集合中包含的元素数量，即数组长度
    uint32_t length;
    
    //保存元素的数组
    int8_t contents[];
} intset;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注意：</p><ul><li>contents[]数组中保存了整数集合中实际的数据元素，数据元素的编码方式是由 encoding 变量决定；也就是说， <ul><li>如果 encoding 属性值为 INTSET_ENC_INT16，那么 contents 就是一个 int16_t 类型的数组，数组中每一个元素的类型都是 int16_t，保存的数据范围是(-32768——32767)；</li><li>如果 encoding 属性值为 INTSET_ENC_INT32，那么 contents 就是一个 int32_t 类型的数组，数组中每一个元素的类型都是 int32_t；</li><li>如果 encoding 属性值为 INTSET_ENC_INT64，那么 contents 就是一个 int64_t 类型的数组，数组中每一个元素的类型都是 int64_t；</li></ul></li></ul><h3 id="升级过程" tabindex="-1"><a class="header-anchor" href="#升级过程" aria-hidden="true">#</a> 升级过程</h3><p>一个保存了三个元素（1， 2， 3）的 int16_t 类型的数组集合中保存了一个 65535 ，则在保存 65535 需要进行升级，升级过程如下：</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706163008.png" alt="20230706163008" loading="lazy"></p><p>可大概分成三个步骤：</p><ol><li>扩容，原本空间的大小之上再扩容多 4x32-3x16=80 位，这样就能保存下 4 个类型为 int32_t 的元素。</li><li>移动已有的元素，从后往前移动；</li><li>在最后添加新元素；</li></ol><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h3><ul><li>整数集合是 Set 数据类型的值对象的数据结构</li><li>支持升级操作，而不是直接使用 int64_t 的数据结构保存元素的原因是为了节省内存使用；</li><li>不支持降级操作；</li></ul><h2 id="linkedlist" tabindex="-1"><a class="header-anchor" href="#linkedlist" aria-hidden="true">#</a> linkedlist</h2><div class="custom-container tip"><p class="custom-container-title">发展过程</p><ol><li>数组</li></ol><ul><li>使用连续内存以达到随机访问的目的，</li><li>其插入和删除操作就非常低效，因为需要移动元素；</li><li>连续内存的条件过于苛刻，在空闲区域中不一定会有满足要求的连续区域；</li><li>多为事先声明的方式进行分配大小，有内存溢出的风险；如果元素个数较少，还会产生内存浪费的问题；</li></ul><ol start="2"><li>单向链表</li></ol><ul><li>使用指针的方式把链表元素连接成串；</li><li>解决了数据的插入和删除操作低效的问题，插入和删除元素不需要移动元素；</li><li>查询元素时间复杂度变成O（n）【最坏情况】</li></ul><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706173704.png" alt="20230706173704" loading="lazy"></p><ol start="3"><li>单向循环链表</li></ol><ul><li>把单向链表中的尾节点的next指针指向头节点</li></ul><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706174238.png" alt="20230706174238" loading="lazy"></p><ol start="4"><li>双向链表</li></ol><ul><li>使用前驱指针和后继指针把前面元素和后续元素连接成串；</li><li>解决了数据的插入和删除操作低效的问题，插入和删除元素不需要移动元素；</li><li>查找元素时间复杂度变成O（1）</li></ul><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706173913.png" alt="20230706173913" loading="lazy"></p><ol start="5"><li>双向循环链表</li></ol><ul><li>把双向链表中的尾节点的后继指针指向头节点，并把头节点的前驱指针指向尾节点；</li></ul><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706174310.png" alt="20230706174310" loading="lazy"></p></div><h3 id="redis的实现-双向无环链表" tabindex="-1"><a class="header-anchor" href="#redis的实现-双向无环链表" aria-hidden="true">#</a> Redis的实现 - 双向无环链表</h3><ul><li>双向</li><li>无环</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>typedef struct listNode{ 
	// 前置节点 
	struct listNode *prev; 
	
  // 后置节点 
	struct listNode *next; 
	
  // 节点的值 
	void *value; 
} listNode;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230707142602.png" alt="双向无环链表" loading="lazy"></p><p>为了更好的管理节点，Redis又设计出list数据结构，用来管理双向无环链表。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>typedef struct list{
  //表头节点
  listNode *head;
  
  //表尾节点
  listNode *tail;
  
  //链表所包含的节点数量
  unsigned long len;
  
  //节点值复制函数
  void *(*dup)(void *ptr);
  
  //节点值释放函数
  void *(*free)(void *ptr);
  
  //节点值对比函数
  int (*match)(void *ptr,void *key);
}list;

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230706184623.png" alt="linkedlist" loading="lazy"></p><hr><h2 id="ziplist" tabindex="-1"><a class="header-anchor" href="#ziplist" aria-hidden="true">#</a> ziplist</h2><div class="custom-container tip"><p class="custom-container-title">压缩列表 VS 数组</p><p>数组中要求保存的元素长度要一样，属于<code>内存紧凑型</code>的数据结构。但是这种数据结构还有一个特点，就是如果要保存的元素的长度不一样，那么就会使用一些补齐的措施来“人为地”保证元素长度一致，这无形中<code>造成了内存浪费</code>的问题。但是内存紧凑的特性又非常吸引人，于是人们设计出压缩列表的数据结构，为每一个元素增加描述字段来表示后续保存的数据的长度及类型等信息，然后把这样具有描述信息+实际数据内容的元素紧凑的保存在一起，就形成了压缩列表。</p><p>压缩列表的出现，有效的解决了数据元素等长特性带来的空间浪费问题，又发挥了数组结构的内存紧凑性的优势。</p></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230707143744.png" alt="20230707143744" loading="lazy"></p><p>压缩列表的描述信息部分：</p><ul><li>zlbytes，记录整个压缩列表占用的内存字节数；</li><li>zltail，记录压缩列表「尾部」节点距离起始地址有多少字节，也就是列表尾的偏移量；</li><li>zllen，记录压缩列表包含的节点数量；</li><li>zlend，标记压缩列表的结束点，固定值 0xFF（十进制255）；</li></ul><p>压缩列表的数据部分——entry，每一个元素都包含：</p><ul><li>prevlen，记录了「前一个节点」的长度，目的是为了实现从后向前遍历；如果前一个节点的长度小于 254 字节，那么 prevlen 属性需要用 1 字节的空间来保存这个长度值；如果前一个节点的长度大于等于 254 字节，那么 prevlen 属性需要用 5 字节的空间来保存这个长度值；</li><li>encoding，记录了当前节点实际数据的「类型和长度」，类型主要有两种：字符串和整数。</li><li>data，记录了当前节点的实际数据，类型和长度都由 encoding 决定；</li></ul><h3 id="连锁更新" tabindex="-1"><a class="header-anchor" href="#连锁更新" aria-hidden="true">#</a> 连锁更新</h3><p>压缩列表除了查找一个元素的过程时间复杂度较高外，还有一个问题就是连锁更新问题。</p><p>在修改压缩列表中的某一个元素时，由于元素长度的变化，会导致这个元素后续的所有元素的存储位置都发生变化。这就是连锁更新。这就造成了内存空间的多次分配过程，从而造成压缩列表的性能下降。</p><h3 id="总结-1" tabindex="-1"><a class="header-anchor" href="#总结-1" aria-hidden="true">#</a> 总结</h3><ol><li>压缩列表吸收了数组的<code>内存紧凑</code>的特性，提高了内存访问效率；但由于每一个元素都需要额外的描述信息以及对整个压缩列表的描述信息，因此也<code>会产生额外的空间浪费</code>；</li><li>此外<code>压缩列表的查找操作的效率也略逊于数组的查找效率</code>；</li><li>压缩列表的更新操作，<code>可能会产生连锁更新</code>的问题；</li></ol><p>因此，也正是因为上述的压缩列表的特性，也使得<code>压缩列表多适用于数据元素较少的业务场景</code>。</p><h2 id="quicklist" tabindex="-1"><a class="header-anchor" href="#quicklist" aria-hidden="true">#</a> quicklist</h2><p>quicklist （ Redis 3.2 引入的数据类型 ，而quicklist底层使用压缩列表和双向无环列表组成，具体见《Redis设计与实现》第8.3章。）本质上，quicklist是由双向无环列表和ziplist构成的复合数据结构。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>typedef struct quicklist { // src/quicklist.h
    quicklistNode *head;
    quicklistNode *tail;
    unsigned long count;        /* ziplist 的个数 */
    unsigned long len;          /* quicklist 的节点数 */
    unsigned int compress : 16; /* LZF 压缩算法深度 */
    //...
} quicklist;
typedef struct quicklistNode {
    struct quicklistNode *prev;
    struct quicklistNode *next;
    unsigned char *zl;           /* 对应的 ziplist */
    unsigned int sz;             /* ziplist 字节数 */
    unsigned int count : 16;     /* ziplist 个数 */
    unsigned int encoding : 2;   /* RAW==1 or LZF==2 */
    unsigned int container : 2;  /* NONE==1 or ZIPLIST==2 */
    unsigned int recompress : 1; /* 该节点先前是否被压缩 */
    unsigned int attempted_compress : 1; /* 节点太小无法压缩 */
    //...
} quicklistNode;
typedef struct quicklistLZF {
    unsigned int sz; 
    char compressed[];
} quicklistLZF;

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/img/notes/quicklist.png" alt="quicklist" loading="lazy"></p><ul><li>新增 <ul><li>判断 head 节点是否可以插入，可以插入，就在 ziplist 上插入，否则，就新建一个 quickListnode 节点进行插入</li></ul></li><li>删除 <ul><li>单个元素： 遍历索引</li><li>区间元素： 先找到start下标的元素所在的quicklistnode，然后删除ziplist上的数据，如果ziplist上能删除的元素个数小于要删除的元素个数，就会移动到下一个quicklistnode，然后进行删除</li></ul></li></ul><h2 id="hashtable" tabindex="-1"><a class="header-anchor" href="#hashtable" aria-hidden="true">#</a> hashtable</h2><div class="custom-container tip"><p class="custom-container-title">前置知识点：哈希及哈希表</p><ol><li>什么是哈希？</li></ol><p>数组这种数据结构中数据元素的内容和在数组中的位置并没有逻辑关系，因为它是通过移动指针来获取数据元素的（是操作系统提供的访问数据的一种机制）。但是哈希提供了一种数据内容与数据存放位置的逻辑关系，也就是说哈希可以通过数据的内容来确定数据存放位置。主要思想是提供一种算法，使数据元素内容与数据存放的位置关联起来。存储的数据结构叫做哈希表，所使用的算法就是哈希。也叫做散列表和散列算法。</p><ol start="2"><li>哈希具有的特性？</li></ol><p>同时具有确定性和不确定性。确定性：key1=key2，那么hash(key1)=hash(key2)；不确定性： key1≠key2，有可能会存在hash(key1)=hash(key2)。确定性，使得根据数据元素的内容获取这个数据元素存放的位置变为可能。不确定性，又使得哈希表在存储数据时，必须要考虑哈希冲突的问题。</p><ol start="3"><li>哈希表的实现方式？</li></ol><p>有两种常见的方式，一种是开放寻址方式，一种是拉链法。开放寻址方式，就是把数据元素放到一个数组中。如果遇到hash（key1） 之后发现这个位置上已经存放有元素时，就直接往下判断，直到找到一个空闲的位置：</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/img/notes/hash-open-find-address.png" alt="" loading="lazy"></p><p>拉链法，就是利用一个数组和多个链表的方式存储数据。数组中保存hash（key）的结果，实际的数据内容保存在与数组相关联的链表上，也就是同一个链表上的保存的所有数据都是hash冲突的数据元素。</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/img/notes/hash-linkedlist.png" alt="" loading="lazy"></p><ol start="4"><li>装载因子</li></ol><p>在哈希表的实现中，以拉链法为例，链表上的数据过多，就代表着哈希冲突比较严重，此时数据元素的查找效率必定会降低；扩大数组的长度，同样多的数据就可以减少哈希冲突，但是这会造成空间的浪费。因此哈希冲突和空间浪费要有一个平衡。装载因子=已有元素个数 / 哈希表能保存的元素总数，装载因子过高容易引起哈希冲突，过低造成存储空间浪费。为了让装载因子处于一个合适的范围，需要对hashtable进行扩容和缩容。</p></div><p>Redis中的Hash数据结构如下：</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/img/notes/hash-hashtable.png" alt="存储结构" loading="lazy"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>typedef struct dict{
  //类型特定函数
  void *type;
  
  //私有数据
  void *privdata;
  
  //哈希表，两个元素
  dictht ht[2];
  
  //rehash到的索引值， 当rehash不在进行时 值为-1，可以看作是
  int trehashidx; 
}dict;

typedef struct dictType{
  //计算哈希值的函数 
  unsigned int  (*hashFunction) (const void *key);
  
  //复制键的函数
  void *(*keyDup) (void *privdata,const void *key);
  
  //复制值的函数
  void *(*keyDup) (void *privdata,const void *obj);
  
  //复制值的函数
  void *(*keyCompare) (void *privdata,const void *key1, const void *key2);
  
  //销毁键的函数
  void (*keyDestructor) (void *privdata, void *key);
  
  //销毁值的函数
  void (*keyDestructor) (void *privdata, void *obj);
}dictType;


typedef struct dictht{
  //哈希表数组，C语言中，*号是为了表明该变量为指针，有几个* 号就相当于是几级指针，这里是二级指针，理解为指向指针的指针
  dictEntry **table;
  
  //哈希表大小
  unsigned long size;
  
  //哈希表大小掩码，用于计算索引值
  unsigned long sizemask;
  
  //该哈希已有节点的数量
  unsigned long used;
}dictht;


//哈希表节点定义dictEntry结构表示，每个dictEntry结构都保存着一个键值对。
typedef struct dictEntry{
  //键
  void *key;
  //值
  union{
    void *val;
    uint64_tu64;
    int64_ts64;
    }v;
  // 指向下个哈希表节点，形成链表
  struct dictEntry *next;
}dictEntry;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="解决哈希冲突" tabindex="-1"><a class="header-anchor" href="#解决哈希冲突" aria-hidden="true">#</a> 解决哈希冲突</h3><p>解决哈希冲突的方式与 Java 中 HashMap 的解决哈希冲突的方式类似，都是在冲突时，把数据存放到链表中。</p><h3 id="rehash" tabindex="-1"><a class="header-anchor" href="#rehash" aria-hidden="true">#</a> Rehash</h3><p>Redis为了保证哈希表具有一个稳定的负载，所以随着数据元素的插入，要不断的调整数组和链表的大小。因此会出现rehash的过程。Rehash有两种方式，一种是集中式Rehash，一种是渐进式Rehash方式。Redis采用渐进式Rehash方式。</p><ul><li>集中式rehash： 一次性的hash，中间不会停止，会影响redis的读写性能，因为要花费资源去进行hash，性能差。例如，要把1GB的数据进行扩容，如果一次性把1GB的数据全部hash完，那么会影响Redis的读写性能；</li><li>渐进式rehash过程：每一次对数据元素的操作，都顺带rehash一个index，直到rehash完成，最后把ht[1]变成ht[0]，最后再申请一个ht[1]，并把rehashidx置为-1，为下次rehash做准备； <ul><li>为ht[1]分配空间，让字典同时拥有ht[0]和ht[1]；</li><li>让rehashidx=0，表示rehash过程开始</li><li>在rehash期间，redis除了对外提供字典的增删改查的数据操作外，还会顺带把ht[0]在rehashidx索引上的所有键值对【即链表上的所有键值对】rehash到ht[1]上，然后再把rehashidx+1； <ul><li>新增操作：直接将键值对插入到ht[1]上，保证ht[0]的结点不会增加；</li><li>删除操作：同时在ht[0]和ht[1]两个哈希表上执行，避免漏删；</li><li>修改操作：同时在ht[0]和ht[1]两个哈希表上执行，避免漏改；</li><li>查找操作：先从ht[0]查，查不到的话再去ht[1]查；</li></ul></li><li>直到rehash完成后，最后把ht[1]变成ht[0]，最后再申请一个ht[1]，并把rehashidx置为-1，为下次rehash做准备；</li></ul></li></ul><p>缩容扩容的条件及缩扩容后的大小：</p><ul><li>扩容 <ul><li>条件： <code>没有执行BGSAVE或没有执行BGREWRITEAOF命令时，负载因子大于等于1</code> || <code>执行BGSAVE或执行BGREWRITEAOF命令时，负载因子大于等于5</code></li><li>大小： 不小于 dict[0].used*2 的第一个2的n次幂，如 dict[0].used = 3，则扩容大小为不小于6的第一个2的n次幂，不小于6的第一个2的n次幂是8，因此扩容大小为8；如 dict[0].used = 4，则扩容大小为不小于8的第一个2的n次幂，不小于8的第一个2的n次幂是8，因此扩容大小依然是8；</li></ul></li><li>缩容 <ul><li>条件：负载因子小于0.1</li><li>大小：不小于 dict[0].used 的第一个2的n次幂，如 dict[0].used = 3，则缩容大小为不小于3的第一个2的n次幂，即4；如 dict[0].used = 4，则缩容大小为不小于4的第一个2的n次幂，即4；</li></ul></li></ul><h2 id="skiplist" tabindex="-1"><a class="header-anchor" href="#skiplist" aria-hidden="true">#</a> skiplist</h2><div class="custom-container tip"><p class="custom-container-title">跳跃表的发展过程</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230707200740.png" alt="20230707200740" loading="lazy"></p><p>针对上图所示的单向链表来说，即便数据存储是有序的，我们在查找某一个数据时，仍然需要从头到尾进行遍历，这样的查找效率低下。于是，我们想，能不能给链表也创建一个索引呢？在单向链表上，每隔几个节点，就创建一个索引。</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230707201227.png" alt="20230707201227" loading="lazy"></p><p>这样，我们在查找某一个数据时，就可以利用索引，来减少遍历的节点个数，从而提高查找效率。同理，我们再在已经创建好的索引上，利用同样的原理再创建一级索引：</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230707201424.png" alt="20230707201424" loading="lazy"></p><p>这样，我们查找某一个数据时，遍历到的节点个数更少了，查找效率也提高的更多了。这样我们就得到了跳跃表的数据结构：</p><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/blog20230707201547.png" alt="20230707201547" loading="lazy"></p></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>typedef struct zskiplist {
  // header:指向跳跃表的表头节点，通过这个指针程序定位表头节点的时间复杂度就为O(1)
  // tail:指向跳跃表的表尾节点，通过这个指针程序定位表尾节点的时间复杂度就为O(1)
  struct zskiplistNode *header, *tail;

  // length:记录跳跃表的长度，也即是，跳跃表目前包含节点的数量(表头节点不计算在内)，通过这个属性，程序可以再O(1)的时间复杂度内返回跳跃表的长度。
  unsigned long length;

  // level:记录目前跳跃表内,层数最大的那个节点的层数(表头节点的层数不计算在内)，通过这个属性可以再O(1)的时间复杂度内获取层高最好的节点的层数。
  int level;
} zskiplist;

typedef struct zskiplistNode {
    // Zset 对象的元素值
    // 在同一个跳跃表中，各个节点保存的成员对象必须是唯一的，但是多个节点保存的分值却可以是相同的。
    // 分值相同的节点将按照成员对象在字典序中的大小来进行排序，成员对象较小的节点会排在前面(靠近表头的方向)，而成员对象较大的节点则会排在后面(靠近表尾的方向)。
    sds ele;
    
    // 元素权重值
    double score;
    
    // 后向指针
    struct zskiplistNode *backward;
  
    // 节点的level数组，保存每层上的前向指针和跨度
    // 每次创建一个新跳跃表节点的时候，程序都根据幂次定律(powerlaw,越大的数出现的概率越小)随机生成一个介于1和32之间的值作为level数组的大小，这个大小就是层的“高度”。
    struct zskiplistLevel {
        struct zskiplistNode *forward;
        unsigned long span;
    } level[];
} zskiplistNode;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><img src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/img/notes/skiplist.png" alt="" loading="lazy"></p><p>说明：</p><ul><li>跳跃表事实上是基于单向链表+索引的方式实现的；</li><li>是以空间换时间的方式提升了查找速度；</li><li>代码中是有 zskiplist 节点 和 zskiplistnode 数组构成的，其中 zskiplist 中保存了跳跃表的描述信息，而 zskiplistnode 数组中主要保存的是实际的数据元素；</li><li>查找元素是从最高层开始查询的；</li><li>跨度就是元素在整个列表中的排位；</li><li>层高都是1至32之间的随机数</li></ul><h2 id="总结-2" tabindex="-1"><a class="header-anchor" href="#总结-2" aria-hidden="true">#</a> 总结</h2><ol><li>Redis针对所要保存的键值对构造了一个基于RedisObject的对象系统，并且每创建一个键值对，Redis都会为我们创建两个RedisObject对象，一个是键对象，一个是值对象；</li><li>针对键对象，Redis使用SDS的数据结构进行保存；而针对值对象，Redis根据所保存的数据类型以及数据长度分别选择不同的数据结构进行保存，具体的数据结构有： <ol><li>SDS</li><li>linkedlist</li><li>ziplist</li><li>quicklist</li><li>intset</li><li>hashtable</li><li>skiplist</li></ol></li><li>Redis在选择某一种数据结构保存值对象时，并不是采用一旦确定就不再修改的策略，而是采用一种动态自适应的策略，这种策略使得Redis能够根据保存的值对象的长度和数据类型，动态的选择数据结构，比如保存hash数据时，数据量小时采用ziplist保存，而数据量大时才使用hashtable的数据结构进行保存；</li><li>值对象选择不同的数据结构保存数据，也有其对应的触发条件；</li><li>Redis3.2版本是一个重大更新版本，这个版本修改了SDS的源码，并基于linkedlist和ziplist实现了quicklist；</li></ol><div class="custom-container tip"><p class="custom-container-title">思考题</p><p>Redis既然能够动态自适应的选择保存的值对象的数据结构，那么值对象的数据结构是否在确定之后就不再修改？还是会动态修改？如果是会动态修改，那么动态修改时的触发条件是什么？比如，值对象起先被选择使用ziplist的形式保存，之后会不会根据数据长度和数据类型的变化，导致这个值对象的数据结构变成了hashtable呢？如果变化了，那么变化的条件又是什么呢？</p></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><ul><li><a href="https://www.laoyu.site/categories/Redis/" target="_blank" rel="noopener noreferrer">Redis<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98" target="_blank" rel="noopener noreferrer">Redis 核心原理与实战<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://xiaolincoding.com/redis/data_struct/data_struct.html" target="_blank" rel="noopener noreferrer">Redis 数据结构<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><hr><p><br><br><br><img style="border:1px red solid;display:block;margin:0 auto;" src="https://tianqingxiaozhu.oss-cn-shenzhen.aliyuncs.com/img/qrcode.jpg" alt="微信公众号"></p><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zeanzai/zeanzai.github.io/edit/main/docs/java/middleware/redis/redisobject/redis_value_dsa.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" aria-labelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2023/8/17 04:43:51</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zeanzai.me@gmail.com">zeanzai</span><!--]--><!--]--></div></footer><nav class="page-nav"><!----><a href="/java/middleware/redis/redisobject/redis_values.html" class="nav-link next" aria-label="支持的数据类型"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">支持的数据类型<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><giscus-widget repo="zeanzai/zeanzai.github.io" repoId="R_kgDOI84HVQ" category="Announcements" categoryId="DIC_kwDOI84HVc4CUKFF" lang="zh-CN" theme="light" mapping="pathname" inputPosition="top" reactionsEnabled="1" emitMetadata="0"></giscus-widget></div><!----></main><!--]--><footer class="footer-wrapper"><div class="footer">浪漫骑士的二流键盘</div><div class="copyright">Copyright © 2023 天晴小猪</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.1d09e1ea.js" defer></script>
  </body>
</html>
