---
title: "05 SpringCloud Ribbon实战"
category:
  - "arch"
tag:
  - "springcloud"
---


## 1. Ribbon概述

### 1.1. 负载均衡的分类

Ribbon的主要作用是负载均衡。

所谓负载均衡，就是把请求流量通过特定的算法分发到不同的操作单元上的过程。在企业级应用中，很少有不用到负载均衡的应用。负载均衡有很多中分类方式，常见的有软负载和硬负载。这里讲另外一种分类方式：`集中式负载均衡`与`进程内负载均衡`。

集中式负载均衡如nginx，实现方式是部署在网络和服务提供者之间，负责把请求分发到各服务提供者上面，这种方式也被成为服务器负载均衡；进程内负载均衡如ribbon，实现的基本思路是，在注册中心中，选取一个服务提供者的实例进行流量导入，这种方式也被成为客户端负载均衡。

### 1.2. 入门案例

1. 创建eureka注册中心模块；
2. 创建client-a工程，并注册到eureka注册中心模块，并在client-a工程中添加controller，主要作用是打印当前实例的端口；
3. 创建Ribbon工程，并注册到eureka注册中心中，并构造请求客户端，且在请求客户端上添加@LoadBalance注解；再创建controller，使用构造的请求客户端调用client-a的服务；

过程：

1. 启动eureka注册中心模块；
2. 分别用不同的端口的配置文件启动client-a工程；
3. 启动Ribbon模块；
4. 在浏览器中通过Ribbon的Controller中的方法调用Client-a的服务，看调用的端口是怎样的；


## 2. 实战

### 2.1. Ribbon的负载均衡策略

nginx的负载均衡策略有：权重、ip_hash、轮询等。对于Ribbon则有七种策略：
1. 随机策略
2. 轮询策略
3. 重试策略：一致尝试选择一个可用的服务
4. 最低并发策略：选择整个集群中并发度最小的
5. 可用过滤策略：过滤高并发连接的主机
6. 响应时间加权策略：响应时间越长，权重越低
7. 区域权衡策略：根据主机所在的区域的性能和主机的可用性选择


### 2.2. 自定义配置

在负载均衡时，可以针对某一个特定的服务执行特定的负载均衡策略。具体操作有三种方式：
1. 全局策略配置
  - 生成一个配置java类，并在里面构建一个bean，改bean中new了对应的 负载规则类。
2. 针对某一特定的服务实现配置
3. 基于配置文件的配置（推荐，不需要修改java代码，如果修改，只需要提一个生产配置单即可）

### 2.3. Ribbon的超时与重试

### 2.4. Ribbon的饥饿加载

### 2.5. 使用配置文件自定义Ribbon客户端

### 2.6. Ribbon脱离Eureka使用

## 3. Ribbon实战

### 3.1. ribbon如何使用RestTemplate实现负载均衡的

### 3.2. 负载均衡策略是怎么实现的









-
<img style="border:1px red solid; display:block; margin:0 auto;" :src="$withBase('/qrcode.jpg')" alt="微信公众号" />
