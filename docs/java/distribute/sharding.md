---
title: "分库分表"
category:
  - "distribute"
tag:
  - "分库分表"
---

## 为什么要分

- 软件系统也不是一上来就进行分库分表的，而是有一个演进过程：
  - 先是试着优化sql，提高单条sql的执行效率；
  - 接着是加缓存、多租户、多数据源、读写分离；
  - 最后才是分库分表；
  - 但随着微服务领域的技术的发展，分库分表已经不重要了；
- RDBMS受单机存储容量、连接数、CPU处理能力、网络带宽等因素影响，容易成为系统瓶颈；

## 什么时候分

1. 能不分就不分

秉持的原则是： 能不分就不分，分库分表是迫不得已的选择，并不是一开始就使用的。这样做的原因是： 过度设计和过早优化会导致系统复杂性增高，可用性降低。因此在分之前要先考虑，机器性能是否已经被压榨到了极限？

因此在系统设计初期，就需要尽早考虑如何压榨RDBMS的机器的性能。一般情况下从下面几个角度去考虑：

- 表设计，基本原则是根据业务进行解耦、创建一些索引用来提高查询效率
- 业务实现上面，基本原则，sql优化、使用缓存、

如： 从sql优化、读写分离、使用缓存、多数据源等方面先进行优化，

1. 


## 理论基础

### 数据切分 

- 垂直切分
  - 垂直分库： 如何分、优缺点
  - 垂直分表： 如何分、优缺点
- 水平切分
  - 水平分库： 如何分、优缺点
  - 水平分表： 如何分、优缺点

### 分库分表带来的问题及解决方案

- 事务一致性问题
- 跨节点关联查询问题
- 跨节点分页、排序、函数执行问题
- 全局主键避重问题
- 数据迁移、扩容、校验
  - 分为停机迁移、不停机迁移
  - 迁移后需要对迁移后的数据进行校验

## 中间件

## 实践案例



## 分库分表演进过程

- 优化SQL
- 加缓存
- 多租户
- 多数据源
- 读写分离 
- 分库分表 




## 参考

- [ShardingSphere进阶](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU3MDAzNDg1MA==&action=getalbum&album_id=2389616635193393153&scene=21#wechat_redirect)
- [lamp-cloud : saas 平台](https://github.com/zuihou/lamp-cloud)
- [如何解决分库分表带来的问题？](https://www.bilibili.com/video/BV1aY411K7qy/)
- [实战彻底搞清分库分表（垂直分库，垂直分表，水平分库，水平分表）](https://cloud.tencent.com/developer/article/1819045)



---

<img style="border:1px red solid; display:block; margin:0 auto;" :src="$withBase('/qrcode.jpg')" alt="微信公众号" />


